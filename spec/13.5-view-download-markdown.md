# Spec 13.5: View and Download Markdown

**Status:** Complete
**Created:** 2025-12-01
**Parent:** [Spec 13: Lightweight Knowledge Base](13-lightweight-knowledge-base.md)

## Overview

Allow users to view markdown content rendered as HTML and download the raw markdown file.

## Requirements

### Functional Requirements

1. **Document Detail Page**
   - Route: `/kb/[id]`
   - Display document title as heading
   - Render markdown content as HTML
   - Show creation date

2. **Navigation**
   - Back link to KB list
   - Consistent nav bar with Ideas/KB links

3. **Download Feature**
   - Download button to save as .md file
   - Filename based on document title

4. **Error Handling**
   - Show error for invalid document ID
   - Handle missing documents gracefully

### Technical Requirements

1. **Route** - `/kb/[id]` using Next.js App Router dynamic route
2. **Server Component** - For SEO and initial data fetch
3. **Markdown Rendering** - Use react-markdown or similar
4. **Download** - Client-side blob download

## Implementation Plan

### Dependencies to Add

1. **react-markdown** - For rendering markdown as HTML

### Files to Create

1. **src/app/kb/[id]/page.tsx** - Document detail page

## Test Cases

### Cypress E2E Tests

**Test 1: Navigate to Document Detail**
```typescript
it("navigates to document detail when clicking title", () => {
  cy.visit("/kb");
  cy.get('[data-testid="kb-document-list"] a').first().click();
  cy.url().should("match", /\/kb\/[a-zA-Z0-9-]+/);
});
```

**Test 2: Display Document Title**
```typescript
it("displays document title on detail page", () => {
  // Navigate to a document
  cy.visit("/kb");
  cy.get('[data-testid="kb-document-list"] a').first().click();
  cy.get("h1").should("exist");
});
```

**Test 3: Display Rendered Markdown**
```typescript
it("renders markdown content as HTML", () => {
  cy.visit("/kb");
  cy.get('[data-testid="kb-document-list"] a').first().click();
  cy.get('[data-testid="document-content"]').should("exist");
});
```

**Test 4: Back to KB List**
```typescript
it("has back link to KB list", () => {
  cy.visit("/kb");
  cy.get('[data-testid="kb-document-list"] a').first().click();
  cy.contains("a", "Back").click();
  cy.url().should("eq", Cypress.config().baseUrl + "/kb");
});
```

**Test 5: Download Button Exists**
```typescript
it("has download button", () => {
  cy.visit("/kb");
  cy.get('[data-testid="kb-document-list"] a').first().click();
  cy.get('[data-testid="download-button"]').should("exist");
});
```

**Test 6: Invalid ID Shows Error**
```typescript
it("shows error for invalid document ID", () => {
  cy.visit("/kb/invalid-id-12345");
  cy.get('[data-testid="document-error"]').should("exist");
});
```

## UI Design

```
┌─────────────────────────────────────────────────────────────┐
│  Idea Backlog    Knowledge Base                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ← Back to Knowledge Base                                   │
│                                                             │
│  Test Document                          [ Download .md ]    │
│  Created: Dec 1, 2025                                       │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                                                     │   │
│  │  # Test Markdown                                    │   │
│  │                                                     │   │
│  │  This is the rendered content of the markdown      │   │
│  │  file with proper formatting.                       │   │
│  │                                                     │   │
│  │  - Bullet points work                               │   │
│  │  - **Bold text** renders                            │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```
